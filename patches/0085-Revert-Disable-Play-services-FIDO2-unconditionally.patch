From f7f8c894c96afdf98e2dbcec2a436fff994ad08a Mon Sep 17 00:00:00 2001
From: Daniel Micay <danielmicay@gmail.com>
Date: Wed, 16 Mar 2022 04:16:16 -0400
Subject: [PATCH] Revert "Disable Play services' FIDO2 unconditionally"

This reverts commit 18c0739aa4b290f8653f56ace87fb49fefd8ffde.
---
 .../webauthn/Fido2CredentialRequest.java          | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/components/webauthn/android/java/src/org/chromium/components/webauthn/Fido2CredentialRequest.java b/components/webauthn/android/java/src/org/chromium/components/webauthn/Fido2CredentialRequest.java
index f3d4397849e89..b309a2de64f36 100644
--- a/components/webauthn/android/java/src/org/chromium/components/webauthn/Fido2CredentialRequest.java
+++ b/components/webauthn/android/java/src/org/chromium/components/webauthn/Fido2CredentialRequest.java
@@ -235,7 +235,20 @@ public class Fido2CredentialRequest implements WindowAndroid.IntentCallback {
 
     /* Initialize the FIDO2 browser API client. */
     private boolean initFido2ApiClient() {
-        return false;
+        if (mFido2ApiClient != null) {
+            return true;
+        }
+
+        if (!ExternalAuthUtils.getInstance().canUseGooglePlayServices(
+                    new UserRecoverableErrorHandler.Silent())) {
+            return false;
+        }
+
+        mFido2ApiClient = Fido.getFido2PrivilegedApiClient(ContextUtils.getApplicationContext());
+        if (mFido2ApiClient == null) {
+            return false;
+        }
+        return true;
     }
 
     // Handles a PendingIntent from the GMSCore Fido library.
